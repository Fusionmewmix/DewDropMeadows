<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dewdrop Meadows - Main Menu</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    body { margin: 0; background-color: navy; overflow: hidden; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script>
class MainMenu extends Phaser.Scene {
  constructor() {
    super('MainMenu');
  }

  preload() {
    this.load.image('MM_Background', 'Assets/Main%20Menu/MM_Background.png');
    this.load.image('DDM_Logo', 'Assets/Main%20Menu/DDM_Logo.png');
    this.load.image('Start_Button', 'Assets/Main%20Menu/Start_Button.png');
    this.load.image('Quit_Button', 'Assets/Main%20Menu/Quit_Button.png');
    this.load.image('Settings_Button', 'Assets/Main%20Menu/Settings_Button.png');
    this.load.image('UI_Short', 'Assets/Main%20Menu/UI_Short.png');
    this.load.image('Sound_Bar', 'Assets/Main%20Menu/Sound_Bar.png');
    this.load.image('Sound_Toggle', 'Assets/Main%20Menu/Sound_Toggle.png');
    this.load.image('Settings_Close', 'Assets/Main%20Menu/Settings_Close.png');
    this.load.audio('Water_Sound', 'Assets/Main%20Menu/Water_Sound.mp3');
    this.load.spritesheet('Bubble_Sheet', 'Assets/Main%20Menu/Bubble_Sheet.png', {
      frameWidth: 1920,
      frameHeight: 1080
    });
  }

  create() {
    // Background
    this.add.image(960, 540, 'MM_Background').setDepth(-3);

    // Looping background music
    this.music = this.sound.add('Water_Sound', { loop: true, volume: 1 });
    this.music.play();

    // Animated water bubble sheet
    const correctFrameOrder = [0, 3, 4, 5, 6, 7, 8, 9, 10, 1, 2];
    this.anims.create({
      key: 'bubbleFloat',
      frames: correctFrameOrder.map(i => ({ key: 'Bubble_Sheet', frame: i })),
      frameRate: 3,
      repeat: -1
    });
    this.bubble = this.add.sprite(960, 540, 'Bubble_Sheet').play('bubbleFloat').setDepth(-2);

    // Background bubbles
    this.backgroundBubbles = [];
    for (let i = 0; i < 15; i++) {
      const g = this.add.graphics();
      g.lineStyle(4, 0xFFFFFF, 0.3);
      g.strokeCircle(0, 0, Phaser.Math.Between(5, 15));
      const container = this.add.container(Phaser.Math.Between(0, 1920), Phaser.Math.Between(1080, 2000), [g]);
      container.speed = Phaser.Math.FloatBetween(0.8, 1.4);
      container.setDepth(-1);
      this.backgroundBubbles.push(container);
    }

    // Logo
    this.add.image(960, 250, 'DDM_Logo').setDepth(1);

    // Main buttons
    const startButton = this.add.image(960, 500, 'Start_Button').setInteractive().setDepth(1);
    const quitButton = this.add.image(960, 620, 'Quit_Button').setInteractive().setDepth(1);
    const settingsButton = this.add.image(960, 740, 'Settings_Button').setInteractive().setScale(0.5).setDepth(1);

    startButton.on('pointerup', () => this.scene.start('NextScene'));
    quitButton.on('pointerup', () => window.close());
    settingsButton.on('pointerup', () => this.showSettings());

    // Enhanced vignette
    const vignette = this.add.graphics().setDepth(0);
    vignette.fillStyle(0x064c5c, 0.4); // darker, deeper
    vignette.fillRect(0, 0, 1920, 1080);
    this.tweens.add({ targets: vignette, alpha: { from: 0.2, to: 0.4 }, duration: 4000, yoyo: true, repeat: -1 });
  }

  showSettings() {
    const bg = this.add.image(960, 540, 'UI_Short').setDepth(10);
    const bar = this.add.image(960, 550, 'Sound_Bar').setDepth(11);
    const toggle = this.add.image(1200, 550, 'Sound_Toggle').setInteractive().setDepth(12);
    const close = this.add.image(960, 670, 'Settings_Close').setInteractive().setDepth(12).setScale(0.5);
    const text = this.add.text(960, 600, '100%', { fontSize: '32px', color: '#000' }).setOrigin(0.5).setDepth(12);

    let isDragging = false;
    toggle.on('pointerdown', () => isDragging = true);
    this.input.on('pointerup', () => isDragging = false);
    this.input.on('pointermove', (pointer) => {
      if (!isDragging) return;
      const minX = 720;
      const maxX = 1200;
      toggle.x = Phaser.Math.Clamp(pointer.x, minX, maxX);
      const percent = Math.round(((toggle.x - minX) / (maxX - minX)) * 100);
      text.setText(`${percent}%`);
      this.music.setVolume(percent / 100);
    });

    close.on('pointerup', () => {
      bg.destroy(); bar.destroy(); toggle.destroy(); close.destroy(); text.destroy();
    });
  }

  update(_, delta) {
    this.bubble.x = 960 + Math.sin(this.time.now * 0.001) * 30;
    this.bubble.setScale(1 + Math.sin(this.time.now * 0.0015) * 0.01);

    this.backgroundBubbles.forEach(b => {
      b.y -= b.speed;
      if (b.y < -50) {
        b.x = Phaser.Math.Between(0, 1920);
        b.y = Phaser.Math.Between(1100, 1500);
      }
    });
  }
}

class NextScene extends Phaser.Scene {
  constructor() {
    super('NextScene');
  }

  create() {
    this.add.text(760, 500, 'Game Scene Loaded', { fontSize: '48px', fill: '#fff' });
  }
}

const config = {
  type: Phaser.AUTO,
  width: 1920,
  height: 1080,
  backgroundColor: '#000022',
  scene: [MainMenu, NextScene],
  scale: {
    mode: Phaser.Scale.NONE,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  audio: {
    disableWebAudio: false
  }
};

new Phaser.Game(config);
</script>
</body>
</html>
