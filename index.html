<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dewdrop Meadows - Main Menu</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    body { margin: 0; background-color: black; overflow: hidden; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script type="module">
import { FishingSystem } from './FishingSystem.js';

class MainMenu extends Phaser.Scene {
  constructor() {
    super('MainMenu');
  }

  preload() {
    this.load.image('MM_Background', 'Assets/Main%20Menu/MM_Background.png');
    this.load.image('DDM_Logo', 'Assets/Main%20Menu/DDM_Logo.png');
    this.load.image('Start_Button', 'Assets/Main%20Menu/Start_Button.png');
    this.load.image('Quit_Button', 'Assets/Main%20Menu/Quit_Button.png');
    this.load.image('Settings_Button', 'Assets/Main%20Menu/Settings_Button.png');
    this.load.image('UI_Short', 'Assets/Main%20Menu/UI_Short.png');
    this.load.image('Sound_Bar', 'Assets/Main%20Menu/Sound_Bar.png');
    this.load.image('Sound_Toggle', 'Assets/Main%20Menu/Sound_Toggle.png');
    this.load.image('Settings_Close', 'Assets/Main%20Menu/Settings_Close.png');
    this.load.audio('Water_Sound', 'Assets/Main%20Menu/Water_Sound.mp3');
    this.load.audio('Outdoors_Sound', 'Assets/Game%20Scene/Outdoors_Sound.mp3');
    this.load.spritesheet('Bubble_Sheet', 'Assets/Main%20Menu/Bubble_Sheet.png', {
      frameWidth: 1920,
      frameHeight: 1080
    });

    for (let i = 1; i <= 8; i++) {
      this.load.image(`BG${i}`, `Assets/Game%20Scene/BG${i}.png`);
    }

    this.load.image('PG_Fish_Book', 'Assets/Game%20Scene/PG_Fish_Book.png');
    this.load.image('PG_Shopping_Cart', 'Assets/Game%20Scene/PG_Shopping_Cart.png');
    this.load.image('Char_Start', 'Assets/Game%20Scene/Char_Start.png');
    this.load.image('Char_throw', 'Assets/Game%20Scene/Char_throw.png');
    this.load.image('Char_throw2', 'Assets/Game%20Scene/Char_throw2.png');
    this.load.image('Char_idle1', 'Assets/Game%20Scene/Char_idle1.png');
    this.load.image('Char_idle2', 'Assets/Game%20Scene/Char_idle2.png');
    this.load.image('Char_pull', 'Assets/Game%20Scene/Char_pull.png');
    this.load.image('Char_Fish', 'Assets/Game%20Scene/Char_Fish.png');
    this.load.image('Char_Broke1', 'Assets/Game%20Scene/Char_Broke1.png');
    this.load.image('Char_Broke2', 'Assets/Game%20Scene/Char_Broke2.png');
    this.load.image('Select_1', 'Assets/Game%20Scene/Select_1.png');
    this.load.image('Select_2', 'Assets/Game%20Scene/Select_2.png');
  }

  create() {
    // [Main menu setup remains unchanged...]
    this.music = this.sound.add('Water_Sound', { loop: true, volume: 0.5 });
    this.music.play();
    // ... your create() code here ...
  }

  // showSettings and update functions remain unchanged
}

class NextScene extends Phaser.Scene {
  constructor() {
    super('NextScene');
  }

  create() {
    const cx = this.cameras.main.centerX;
    const cy = this.cameras.main.centerY;

    this.add.image(cx, cy, 'BG1').setDisplaySize(1920, 1080).setDepth(1);
    this.sun = this.add.image(cx, cy, 'BG4').setScale(0.8).setDepth(4);
    this.tweens.add({ targets: this.sun, alpha: { from: 1, to: 0.7 }, duration: 2000, yoyo: true, repeat: -1 });

    this.clouds = this.add.image(cx, cy - 100, 'BG5').setDepth(5);
    this.trees = this.add.image(cx, cy, 'BG2').setDepth(2);
    this.add.image(cx, cy, 'BG3').setDepth(3);
    this.foilage = this.add.image(cx, cy, 'BG6').setDepth(6);
    this.add.image(cx, cy, 'BG7').setDepth(7);
    this.add.image(cx, cy, 'BG8').setDepth(8);

    this.char = this.add.image(cx, cy, 'Char_Start').setDepth(9);
    this.cursor = this.add.image(580, 790, 'Select_2').setScale(0.5).setDepth(10);
    this.cursorFrames = ['Select_2', 'Select_1'];
    this.cursorFrameIndex = 0;
    this.cursorTimer = this.time.addEvent({
      delay: 500,
      callback: () => {
        this.cursorFrameIndex = (this.cursorFrameIndex + 1) % this.cursorFrames.length;
        this.cursor.setTexture(this.cursorFrames[this.cursorFrameIndex]);
      },
      loop: true
    });

    const book = this.add.image(0, 0, 'PG_Fish_Book').setOrigin(1, 1).setScale(0.5).setInteractive().setDepth(10);
    const cart = this.add.image(0, 0, 'PG_Shopping_Cart').setOrigin(1, 1).setScale(0.5).setInteractive().setDepth(10);
    cart.setPosition(this.cameras.main.width - 40, this.cameras.main.height - 40);
    book.setPosition(cart.x - cart.displayWidth - 20, this.cameras.main.height - 40);

    this.outdoorSound = this.sound.add('Outdoors_Sound', { loop: true, volume: 0 });
    this.outdoorSound.play();
    this.tweens.add({ targets: this.outdoorSound, volume: 0.5, duration: 2000 });

    const gear = this.add.image(40, this.cameras.main.height - 40, 'Settings_Button')
      .setOrigin(0, 1).setScale(0.6).setDepth(10).setInteractive();
    gear.on('pointerdown', () => {
      if (!this.settingsOpen) this.showSettings(this.outdoorSound);
    });

    // Fishing logic
    const fishing = new FishingSystem(this);
    this.input.once('pointerdown', () => {
      this.cursor.destroy();
      this.cursorTimer.remove();

      this.char.setTexture('Char_throw');
      this.time.delayedCall(300, () => {
        this.char.setTexture('Char_throw2');
        this.time.delayedCall(300, () => {
          this.char.setTexture('Char_idle1');

          let idleState = 0;
          const idleLoop = this.time.addEvent({
            delay: 600,
            callback: () => {
              idleState = 1 - idleState;
              this.char.setTexture(idleState ? 'Char_idle2' : 'Char_idle1');
            },
            loop: true
          });

          // Start fishing logic during idle loop
          fishing.startFishing((result) => {
            idleLoop.remove();
            this.char.setTexture('Char_pull');

            this.time.delayedCall(600, () => {
              if (result.type === 'rock') {
                this.char.setTexture('Char_Broke1');
                this.time.delayedCall(1000, () => {
                  this.char.setTexture('Char_Broke2');
                  this.time.delayedCall(1000, () => {
                    this.char.setTexture('Char_Start');
                  });
                });
              } else {
                this.char.setTexture('Char_Fish');
                this.time.delayedCall(1000, () => {
                  this.char.setTexture('Char_Start');
                });
              }

              if (fishing.hasWon()) {
                console.log("You've caught all fish types! You win!");
              }
            });
          });
        });
      });
    });
  }

  // showSettings and update remain unchanged
}

const config = {
  type: Phaser.AUTO,
  width: 1920,
  height: 1080,
  backgroundColor: '#000000',
  scene: [MainMenu, NextScene],
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  audio: {
    disableWebAudio: false
  }
};

new Phaser.Game(config);
</script>
</body>
</html>
